<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEDI - Interface Tablette</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üì±</text></svg>">
    <link rel="stylesheet" href="assets/styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- QuaggaJS pour le scan de code-barres -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
</head>
<body>
    <div id="app">
        <!-- √âcran de connexion -->
        <div id="loginScreen" class="screen active">
            <div class="login-container">
                <div class="logo">
                    <i class="fas fa-industry"></i>
                    <h1>SEDI ERP</h1>
                </div>
                <form id="loginForm">
                    <div class="input-group">
                        <i class="fas fa-user"></i>
                        <input type="text" id="operatorCode" placeholder="Code Op√©rateur" required>
                    </div>
                    <button type="submit" class="btn-primary">
                        <i class="fas fa-sign-in-alt"></i>
                        Se connecter
                    </button>
                </form>
                <div class="admin-access">
                    <button id="adminModeBtn" class="btn-secondary">
                        <i class="fas fa-cog"></i>
                        Mode Administrateur
                    </button>
                </div>
            </div>
        </div>

        <!-- √âcran de connexion admin -->
        <div id="adminLoginScreen" class="screen">
            <div class="login-container">
                <div class="logo">
                    <i class="fas fa-shield-alt"></i>
                    <h1>Administration</h1>
                </div>
                <form id="adminLoginForm">
                    <div class="input-group">
                        <i class="fas fa-user-shield"></i>
                        <input type="text" id="adminUsername" placeholder="Nom d'utilisateur" required>
                    </div>
                    <div class="input-group">
                        <i class="fas fa-lock"></i>
                        <input type="password" id="adminPassword" placeholder="Mot de passe" required>
                    </div>
                    <button type="submit" class="btn-primary">
                        <i class="fas fa-sign-in-alt"></i>
                        Se connecter
                    </button>
                </form>
                <div class="back-to-login">
                    <button id="backToLoginBtn" class="btn-secondary">
                        <i class="fas fa-arrow-left"></i>
                        Retour
                    </button>
                </div>
            </div>
        </div>

        <!-- Interface Op√©rateur -->
        <div id="operatorScreen" class="screen">
            <header class="header">
                <div class="user-info">
                    <i class="fas fa-user-circle"></i>
                    <span id="currentOperator"></span>
                </div>
                <button id="logoutBtn" class="btn-secondary">
                    <i class="fas fa-sign-out-alt"></i>
                    D√©connexion
                </button>
            </header>

            <main class="main-content">
                <!-- Saisie du lancement -->
                <div class="section">
                    <h2><i class="fas fa-keyboard"></i> Code de Lancement</h2>
                    <div class="input-group">
                        <i class="fas fa-barcode"></i>
                        <input
                            type="tel"
                            id="lancementSearch"
                            placeholder="Saisir le code de lancement..."
                            autocomplete="off"
                            value="LT"
                            inputmode="numeric"
                            pattern="[0-9]*"
                            maxlength="10"
                            aria-label="Saisir les chiffres du code de lancement"
                        >
                        <button id="scanBarcodeBtn" class="btn-scan" title="Scanner un code-barres">
                            <i class="fas fa-camera"></i>
                        </button>
                    </div>
                    <div id="lancementList" class="lancement-list" style="display: none;"></div>
                    <div class="help-text">
                        <small><i class="fas fa-info-circle"></i> "LT" est pr√©-rempli, saisissez seulement les chiffres (ex: LT2501145) ou utilisez le scanner</small>
                    </div>
                </div>

                <!-- Contr√¥les de lancement -->
                <div class="section" id="controlsSection" style="display: none;">
                    <h2><i class="fas fa-cogs"></i> Contr√¥les</h2>
                    <div class="lancement-info">
                        <h3 id="selectedLancement"></h3>
                        <p id="lancementDetails"></p>
                    </div>
                    <div class="controls-row">
                        <div class="controls">
                            <button id="startBtn" class="btn-success">
                                <i class="fas fa-play"></i>
                                D√©marrer
                            </button>
                            <button id="pauseBtn" class="btn-warning" disabled>
                                <i class="fas fa-pause"></i>
                                Pause
                            </button>
                            <button id="stopBtn" class="btn-danger" disabled>
                                <i class="fas fa-stop"></i>
                                Terminer
                            </button>
                        </div>
                        <div class="end-time-display">
                            <div class="end-time-label">Heure de fin pr√©vue :</div>
                            <div class="end-time-value" id="endTimeDisplay">--:--</div>
                        </div>
                    </div>
                    <div class="timer">
                        <div class="timer-display" id="timerDisplay">00:00:00</div>
                        <div class="status" id="statusDisplay">En attente</div>
                    </div>
                </div>

                <!-- Historique des lancements -->
                <div class="section">
                    <h2><i class="fas fa-history"></i> Mon Historique</h2>
                    <div class="history-controls">
                        <button id="refreshHistoryBtn" class="btn-primary">
                            <i class="fas fa-sync"></i>
                            Actualiser
                        </button>
                    </div>
                    <div class="data-table tablet-optimized">
                        <div class="table-container">
                            <table id="operatorHistoryTable">
                                <thead>
                                    <tr>
                                        <th>Code</th>
                                        <th>D√©signation</th>
                                        <th>Phase</th>
                                        <th>D√©but</th>
                                        <th>Fin</th>
                                        <th>Statut</th>
                                    </tr>
                                </thead>
                                <tbody id="operatorHistoryTableBody">
                                    <tr><td colspan="6" class="no-data">Chargement de l'historique...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Section Commentaires -->
                <div class="section">
                    <h2><i class="fas fa-comments"></i> Commentaires</h2>
                    <div class="comment-form">
                        <div class="input-group">
                            <i class="fas fa-edit"></i>
                            <textarea id="commentInput" placeholder="Ajouter un commentaire sur cette op√©ration..." rows="3" maxlength="2000"></textarea>
                        </div>
                        <div class="comment-actions">
                            <button id="addCommentBtn" class="btn-primary" disabled>
                                <i class="fas fa-paper-plane"></i>
                                Envoyer Commentaire
                            </button>
                            <span class="comment-counter">
                                <span id="commentCharCount">0</span>/2000 caract√®res
                            </span>
                        </div>
                    </div>
                    
                    <div class="comments-list" id="commentsList">
                        <div class="no-comments">
                            <i class="fas fa-comment-slash"></i>
                            <p>Aucun commentaire pour le moment</p>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- Interface Admin -->
        <div id="adminScreen" class="screen">
            <header class="header">
                <h1><i class="fas fa-chart-line"></i> Tableau de Bord Admin</h1>
                <div>
                    <button id="backToOperatorBtn" class="btn-secondary">
                        <i class="fas fa-arrow-left"></i>
                        Retour Op√©rateur
                    </button>
                </div>
            </header>

            <main class="main-content">
                <div class="admin-controls">
                    <!-- Ligne 1: Filtres -->
                    <div class="filters-row">
                        <div class="filter-group">
                            <label for="operatorFilter">
                                <i class="fas fa-user"></i>
                                Op√©rateur :
                            </label>
                            <select id="operatorFilter" class="filter-select">
                                <option value="">Tous les op√©rateurs</option>
                            </select>
                        </div>
                        
                        <!-- Indicateur des op√©rateurs actifs -->
                        <div class="filter-group">
                            <div id="activeOperatorsIndicator" class="active-operators-indicator">
                                <span class="badge badge-secondary">Chargement...</span>
                            </div>
                        </div>
                        
                        <div class="filter-group">
                            <label for="statusFilter">
                                <i class="fas fa-tasks"></i>
                                Statut :
                            </label>
                            <select id="statusFilter" class="filter-select">
                                <option value="">Tous les statuts</option>
                                <option value="EN_COURS">En cours</option>
                                <option value="PAUSE">En pause</option>
                                <option value="TERMINE">Termin√©</option>
                                <option value="PAUSE_TERMINEE">Pause termin√©e</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label for="periodFilter">
                                <i class="fas fa-calendar"></i>
                                P√©riode :
                            </label>
                            <select id="periodFilter" class="filter-select">
                                <option value="today">Aujourd'hui</option>
                                <option value="week">Cette semaine</option>
                                <option value="month">Ce mois</option>
                                <option value="custom">Personnalis√©</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label for="searchFilter">
                                <i class="fas fa-search"></i>
                                Recherche :
                            </label>
                            <input type="text" id="searchFilter" class="filter-input" placeholder="Code lancement...">
                        </div>
                    </div>
                    
                    <!-- Ligne 2: Actions -->
                    <div class="actions-row">
                        <button id="addOperationBtn" class="btn-success">
                            <i class="fas fa-plus"></i>
                            Ajouter une ligne
                        </button>
                        <button id="refreshDataBtn" class="btn-primary">
                            <i class="fas fa-sync"></i>
                            Actualiser
                        </button>
                        <button id="transferBtn" class="btn-warning">
                            <i class="fas fa-exchange-alt"></i>
                            Transfert
                        </button>
                        <button id="clearFiltersBtn" class="btn-secondary">
                            <i class="fas fa-times"></i>
                            Effacer filtres
                        </button>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <i class="fas fa-users"></i>
                        <h3 id="totalOperators">0</h3>
                        <p>Op√©rateurs actifs</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-play-circle"></i>
                        <h3 id="activeLancements">0</h3>
                        <p>Lancements en cours</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-pause-circle"></i>
                        <h3 id="pausedLancements">0</h3>
                        <p>Lancements en pause</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-check-circle"></i>
                        <h3 id="completedLancements">0</h3>
                        <p>Lancements termin√©s</p>
                    </div>
                </div>

                <div class="data-table">
                    <h3>D√©tails des Op√©rations</h3>
                    <div class="table-container">
                        <table id="operationsTable">
                        <thead>
                            <tr>
                                <th>Op√©rateur</th>
                                <th>Code Lancement</th>
                                <th>Designation</th>
                                <th>Heure D√©but</th>
                                <th>Heure Fin</th>
                                <th>Statut</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                            <tbody id="operationsTableBody">
                            </tbody>
                        </table>
                    </div>
                    <div id="paginationInfo" class="pagination-container">
                        <!-- Les informations de pagination seront ajout√©es ici par JavaScript -->
                    </div>
                </div>


            </main>
        </div>
    </div>

    <!-- Modal pour le scanner de code-barres -->
    <div id="barcodeScannerModal" class="scanner-modal" style="display: none;">
        <div class="scanner-modal-content">
            <div class="scanner-modal-header">
                <h2><i class="fas fa-camera"></i> Scanner un code-barres</h2>
                <button id="closeScannerBtn" class="btn-close-scanner">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="scanner-modal-body">
                <div id="scannerContainer" class="scanner-container">
                    <div id="scannerViewport" class="scanner-viewport"></div>
                    <div class="scanner-overlay">
                        <div class="scanner-line"></div>
                        <p class="scanner-instructions">Positionnez le code-barres dans le cadre</p>
                    </div>
                </div>
                <div id="scannerStatus" class="scanner-status">
                    <i class="fas fa-circle-notch fa-spin"></i>
                    <span>Initialisation de la cam√©ra...</span>
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="index.js?v=20251021-cache-bust"></script>
</body>
</html>
